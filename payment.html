<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Payment | Bibliotheca.</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-800 font-sans">

  <!-- HEADER -->
  <header class="bg-white shadow sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-indigo-600">Bibliotheca.</h1>
      <nav class="hidden md:flex gap-6 font-medium">
        <a href="index.html" class="hover:text-indigo-600">Home</a>
        <a href="shop.html" class="hover:text-indigo-600">Shop</a>
        <a href="cart.html" class="hover:text-indigo-600">Cart</a>
      </nav>
    </div>
  </header>

  <!-- PAYMENT SECTION -->
  <section class="max-w-lg mx-auto mt-10 bg-white p-6 rounded-xl shadow">
    <h2 class="text-2xl font-bold text-center text-indigo-700 mb-6">
      Secure Payment
    </h2>

    <form id="paymentForm" class="space-y-5">

      <!-- PAYMENT METHOD -->
      <div>
        <label class="block font-semibold mb-2">Payment Method</label>
        <select id="paymentMethod" class="w-full border px-4 py-2 rounded">
          <option value="upi">UPI (Recommended)</option>
          <option value="card">Card (via UPI)</option>
        </select>
        <p class="text-sm text-gray-500 mt-1">
          All payments are processed via FamPay UPI
        </p>
      </div>

      <!-- CARD INFO (UI ONLY) -->
      <div id="cardFields" class="hidden space-y-2">
        <input type="text" class="w-full border px-4 py-2 rounded" placeholder="Card Number (UI only)">
        <div class="flex gap-2">
          <input type="text" class="w-1/2 border px-4 py-2 rounded" placeholder="MM/YY">
          <input type="text" class="w-1/2 border px-4 py-2 rounded" placeholder="CVV">
        </div>
        <p class="text-xs text-red-500">
          Card payments are redirected to FamPay UPI
        </p>
      </div>

      <!-- UPI SECTION -->
      <div id="upiSection" class="space-y-3">
        <div class="bg-indigo-50 p-3 rounded text-center">
          <p class="font-medium">Pay to FamPay UPI</p>
          <p class="text-indigo-700 font-semibold" id="upiIdText"></p>
        </div>

        <div class="flex justify-center">
          <img src="qr/GooglePay_QR.jpeg"
               alt="UPI QR"
               class="w-40 h-40 border rounded shadow">
        </div>

        <button type="button"
                id="payNowBtn"
                class="w-full bg-green-600 text-white py-3 rounded font-semibold hover:bg-green-700 transition">
          Open UPI App & Pay
        </button>
      </div>

      <!-- UTR FIELD -->
      <div>
        <label class="block font-semibold mb-2">
          Transaction ID (UTR) <span class="text-red-500">*</span>
        </label>
        <input type="text"
               id="utr"
               class="w-full border px-4 py-2 rounded"
               placeholder="Enter 12+ digit UTR number"
               minlength="12"
               required>
      </div>

      <!-- SUBMIT -->
      <button type="submit"
              class="w-full bg-indigo-600 text-white py-3 rounded font-semibold hover:bg-indigo-700 transition">
        Verify & Continue
      </button>

    </form>
  </section>

  <!-- SCRIPT -->
  <script>
    const FAMPAY_UPI = "yourname@fampay"; // ðŸ”´ CHANGE THIS
    document.getElementById("upiIdText").textContent = FAMPAY_UPI;

    const method = document.getElementById("paymentMethod");
    const cardFields = document.getElementById("cardFields");
    const payBtn = document.getElementById("payNowBtn");

    method.addEventListener("change", () => {
      cardFields.classList.toggle("hidden", method.value !== "card");
    });

    function openUPI(amount) {
      const upiURL =
        `upi://pay?pa=${FAMPAY_UPI}&pn=Bibliotheca&am=${amount}&cu=INR&tn=Book Purchase`;
      window.location.href = upiURL;
    }

    payBtn.addEventListener("click", () => {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const total = cart.reduce((s, i) => s + i.price, 0);
      openUPI(total);
    });

    document.getElementById("paymentForm").addEventListener("submit", e => {
      e.preventDefault();

      const utr = document.getElementById("utr").value.trim();
      if (utr.length < 12) {
        alert("Please enter a valid Transaction ID (UTR)");
        return;
      }

      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const total = cart.reduce((s, i) => s + i.price, 0);

      const order = {
        items: cart,
        total,
        paymentMethod: "FamPay UPI",
        utr,
        date: new Date().toLocaleString()
      };

      localStorage.setItem("lastOrder", JSON.stringify(order));
      localStorage.removeItem("cart");

      window.location.href = "receipt.html";
    });
  </script>

</body>
</html>
